general:
  whitelist: true
  pipeline_base_name: OpenShift UAT Deployment
  dependency:
#    - Microservice_Acceptance [PostStage]
   - Catalog [PostStage]
   - Customer [PostStage]
   - Order [PostStage]
   - Zuul [PostStage]
#   - AndroidApp [BuildAPK]

pre_stage:
  go_cd_agent_props:
    - ansible
  custom_cmd:
    - sudo apt-get update
    - sudo apt-get -y install python-pip
    - sudo apt-get -y install dnsutils
    - sudo pip install jmespath
    - sudo ansible-galaxy install angstwad.docker_ubuntu
    - sudo chown -R go:go /var/go

production:
  go_cd_agent_props:
    - ansible
  trigger_mode: manual
  stages:
    - stage: OpenShift
      jobs:
        - job: DeployApp
          tasks:
            - task: wget https://github.com/openshift/origin/releases/download/v1.4.1/openshift-origin-client-tools-v1.4.1-3f9807a-linux-64bit.tar.gz 
            - task: tar -xvzf openshift-origin-client-tools-v1.4.1-3f9807a-linux-64bit.tar.gz
            - task: ./oc login https://ocp-tdemo-lb.ocp-tdemo.teco.prd.a.tecdomain.net:8443 --token=$OSTOKEN --insecure-skip-tls-verify=true
              build_path: openshift-origin-client-tools-v1.4.1-3f9807a-linux-64bit.tar.gz
#            - task: ./oc import docker-compose -f ../docker-compose/docker-compose.yml
#              build_path: openshift-origin-client-tools-v1.4.1-3f9807a-linux-64bit.tar.gz
            - task: ./oc deploy catalog --latest -n ecommercev5
              build_path: openshift-origin-client-tools-v1.4.1-3f9807a-linux-64bit.tar.gz
            - task: ./oc deploy order --latest -n ecommercev5
              build_path: openshift-origin-client-tools-v1.4.1-3f9807a-linux-64bit.tar.gz
            - task: ./oc deploy customer --latest -n ecommercev5
              build_path: openshift-origin-client-tools-v1.4.1-3f9807a-linux-64bit.tar.gz
            - task: ./oc deploy zuul --latest -n ecommercev5
              build_path: openshift-origin-client-tools-v1.4.1-3f9807a-linux-64bit.tar.gz
