general:
  whitelist: true
  pipeline_base_name: UAT Deployment
  dependency:
   - Microservice_Acceptance [PostStage]

pre_stage:
  go_cd_agent_props:
    - ansible
  custom_cmd:
    - sudo apt-get -y install python-pip
    - sudo pip install jmespath
    - sudo ansible-galaxy install angstwad.docker_ubuntu
    - sudo chown -R go:go /var/go

production:
  go_cd_agent_props:
    - ansible
  trigger_mode: manual
  stages:
    - stage: DeployInstance
      jobs:
        - job: CreateAndDeployInstance
          tasks:
            - task: ansible-playbook -i ansible-scripts/inventory ansible-scripts/deploy-instance.yml -vvvv
              build_path: .
              # run_if_conditions: passed
            - task: ansible-playbook -i ansible-scripts/inventory ansible-scripts/install-microservice-demo.yml -vvvv
              build_path: .
              # run_if_conditions: passed
    - stage: DeleteInstance
      jobs:
        - job: Delete
          tasks:
            - task: ansible-playbook -i ansible-scripts/inventory ansible-scripts/delete-instance.yml -vvvv
              build_path: .
              run_if_conditions: passed
